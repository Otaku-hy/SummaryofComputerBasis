## Transport layer

1. 传输层任务：为应用进程间提供端到端的服务

2. 主要功能：传输层寻址；提供有连接(TCP)和无连接(UDP)的服务；服用和分解；错误和流量控制

3. 传输协议要素：

   a. 寻址：通过IP地址+端口号标识一个TSAP，除一些应用有熟知端口外其他端口通过端口映射器登记并分配

   ​	此外，使用初始连接协议：使用进程服务器代理不频繁使用的服务器

   b. 连接建立：prob: 连接确认没有及时到达导致的多重连接

   ​			solve：增加packet seq/ 限制packet lifetime(hop)

   ​			三次握手：

   <img src=".\images\image-20231224113058445.png" alt="image-20231224113058445" style="zoom:25%;" />

   c. 连接释放：prob: 非对称释放导致数据丢失，对称释放要求每个单向连接单独释放，但可能一边的请求丢失

   ​			solve: 三次握手+计时器（有可能造成半开连接）

   <img src=".\images\image-20231224123225372.png" alt="image-20231224123225372" style="zoom:25%;" />

   ​			如果host1计时器未收到DR消息则重传，多次重传失败则直接关闭

   ​			如果host2计时器未收到ack则直接关闭

   d. 差错流量控制：使用停-等协议和滑动窗口

   ​	*传输层连接多带宽延迟积大，所以使用动态的缓存分配策略

    1. 缓冲区组织方式：链式固定大小（浪费）；链式可变大小（管理复杂）；大环形缓冲区

    2. 管理策略：发送端请求缓冲区，接收端尽可能分配缓冲区，发送方发送段时减少他被分配的缓冲

       接收方流量捎带确认和可用缓冲数量

   e. 多路复用：多个端口对应一个网络地址接口，通过端口号指明当段到达时要交给哪个进程处理

   f. 崩溃恢复：从第N层崩溃中的恢复 工作只能由N+1层完成

   

   
   
   
   
   
   
   
   
   
   
   
   
   ​			
   
   ​			

