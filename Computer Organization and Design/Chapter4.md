## 总线&IO

### 1. 总线

1. 结构：片内总线/系统总线(数据线+地址线+控制线)/通信总线

2. 总线仲裁*：集中仲裁方式：由总线控制器进行所有总线请求的分配管理

   流程：主设备发出BR；若多个主设备都BR，总线控制器判优按一定优先级决定哪个设备使用总线，并发送BG；获得总线控制权的设备开始传输数据

   a. 链式查询：固定优先级链，BG从控制器发向最近的主模块，当其不使用时将BG向后传递，直到一个发出BR的模块，截断该BG信号，并发送BS告知控制器当前有设备使用总线

   pros&cons：结构简单易于扩充；但有设备故障时无法正确运作，无法修改优先级，低优先级饥饿问题

   b. 计时器定时查询：不使用BG而使用设备地址信号，查询时计时器将计数值作为设备地址发送给各个模块，模块地址若匹配则发送BS。如不，计数值+1，继续向下查询直到匹配

   pros&cons：优先级灵活，电路故障不影响；但增加控制线，控制过程复杂

   c. 独立请求：每个模块专门的BR和BG和控制器相连，控制器内部设置一个排队电路进行判优，然后向优先级高的模块发送BG

   pros&cons：响应速度块；但是控制线更过，硬件开销大

3. 总线通讯*

   a. 同步通讯：使用统一的时钟信号控制数据传输的过程

   ​	pros&cons：控制简单；但当各部件速度相距较大时，为保证数据的传送正确，必须以最慢的设备设置时钟信号

   b. 异步通讯：模块间使用应答的方式建立联系，不许使用统一同步信号

    1. 不互锁：发送信号一段时间自动撤销，数据信号一段时间也自动撤销

       **导致传输可靠性差

    2. 半互锁：当发送端接受到了数据后才撤销require信号，数据信号则一段时间自动撤销

    3. 全互锁：双放均需要来自另一端的ACK才会撤销信号(e.g. 接收到data/已撤销req)

       **可靠性高

4. 总线性能指标

   总线传输周期：进行一次总线操作的时间

   总线时钟周期：机器时钟周期

   总线工作频率：一秒内几次传输操作

   时钟频率：时钟周期倒数

   总线宽度：数据线位数

   总线带宽：单位时间内总线传输的数据位数

